[(#REM)
	<!-- 
		******************************************
		Options : ordre et correspondance des clés
		******************************************

		0 => coupon : id_auteur (bénéficiaire de l'abonnement offert)
		1 => numero : reférence du numéro de départ
		2 => cadeau : id_produit (cadeau qui accompagne l'abonnement personnel)
	-->
]
<BOUCLE_panier_article_abonnement(PANIERS_LIENS){id_panier}{id_objet=#ENV{id_objet}}>
	<BOUCLE_options(DATA){source tableau, #OPTIONS}>
		#SET{cle, #CLE}
		<BOUCLE_option(DATA){source tableau, #VALEUR}>
			#SET{option_#CLE, #VALEUR}
		</BOUCLE_option>
		
		<BOUCLE_abonnement(ABONNEMENTS_OFFRES){id_abonnements_offre=#ID_OBJET}>
			[(#SET{titre, #TITRE})]
			[(#SET{numeros, #DUREE|numeros_nombre_en_clair})]
			
			[(#REM)
				<!--
					Deux options possibles : 
					- ou bien c'est un abonnement personnel, 
					option_1 doit contenir au moins une référence du numéro de départ ;
					- ou bien c'est un abonnement offert, 
					option_0 doit contenir l'id_auteur du bénéficiaire.
				-->
			][(#SET{abonnement_ok, ''})][(#SET{erreur, ''})]
			[(#GET{option_0}|=={non}|et{#GET{option_1}|oui}|oui) 
				[(#SET{abonnement_ok, ' '})]
				[(#SET{numero_debut, #GET{option_1}})]
			][
			(#GET{option_0}|is_numeric|oui) 
				[(#SET{abonnement_ok, ' '})]
				[(#SET{id_beneficiaire, #GET{option_0}})]
				[(#SET{numero_debut, #ENV{reference_numero_actuel}})]
			][
			(#GET{numero_debut}|non) #SET{numero_debut, #ENV{reference_numero_actuel}}
			]
			
			<li class="o-list-bare__item c-panier-mini-item c-panier-mini-article">
				<div class="c-panier-mini-article__img c-panier-mini-article__img--collection">
					[(#INCLURE{fond=inclure/logo/abonnement-collection-numeros, largeur=100, reference_numero_debut=#GET{numero_debut}, nombre_numeros=#DUREE|intval|div{3}|moins{1}})]
				</div>
				<div class="c-panier-mini-item__descriptif c-panier-mini-article__descriptif">
					<div class="c-panier-mini-item__titre c-panier-mini-article__titre u-typo-font-vacarme">
						[<h3 class="c-panier-mini-item__intitule c-panier-mini-article__intitule"><:vpaniers:abonnement_resume_label_abonnement:> (#TITRE)[ / (#GET{numeros})]</h3>]
						[<span>(#PRIX{#OBJET,#ID_OBJET})</span>]
					</div>
					[(#GET{abonnement_ok}|oui)
						[(#GET{option_1}|oui)
							[<p class="c-panier-mini-item__designation"><span><:vpaniers:abonnement_resume_label_numero:></span> (#GET{option_1}|calculer_numero_futur_titre{0})</p>]]
						[(#GET{option_2}|>={0}|oui)
							[<p class="c-panier-mini-item__designation"><span><:vpaniers:abonnement_resume_label_cadeau:></span> (#GET{option_2}|=={0}|?{<:vpaniers:abonnement_resume_cadeau_vide:>,[(#INFO_TITRE{produit, #GET{option_2}})]})</p>]
						][(#GET{id_beneficiaire}|oui)
							[(#INCLURE{fond=inclure/panier-description-beneficiaire, id_auteur=#GET{id_beneficiaire}})]]
					][(#GET{abonnement_ok}|non)
						<p class="c-message c-message--erreur"><:vpaniers:erreur_abonnement_incomplet_panier_mini:></p>
					]
					<p class="c-panier-mini-item__designation c-panier-mini-article__designation">[(#QUANTITE) &times; ][(#PRIX{#OBJET,#ID_OBJET})]</p>
				</div>
			</li>
		</BOUCLE_abonnement>
	</BOUCLE_options>
</BOUCLE_panier_article_abonnement>
